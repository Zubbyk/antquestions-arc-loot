<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Antquestions Loot</title>
  <style>
    :root{
      --bg:#0b0f18;
      --panel:#111829;
      --panel2:#0f1524;
      --border:#22304d;
      --text:#e9eefc;
      --muted:#a7b4d6;
      --accent:#7c5cff;
      --ok:#25d07f;
      --danger:#ff5c7a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(900px 500px at 20% 0%, rgba(124,92,255,.18), transparent 60%),
                  radial-gradient(700px 500px at 90% 10%, rgba(37,208,127,.10), transparent 60%),
                  linear-gradient(180deg, #070a12, var(--bg) 30%, #060812 100%);
      color:var(--text);
      min-height:100vh;
    }

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(7,10,18,.72);
      border-bottom:1px solid rgba(34,48,77,.55);
    }
    .wrap{max-width:1180px; margin:0 auto; padding:14px 16px}
    .topbar{display:flex; gap:12px; align-items:center; flex-wrap:wrap;}
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:900; letter-spacing:.2px;
      user-select:none;
    }
    .logo{
      width:28px; height:28px; border-radius:10px;
      background: conic-gradient(from 180deg, var(--accent), #2fd1ff, var(--ok), var(--accent));
      box-shadow:none;
      flex:0 0 auto;
    }
    .brand .title{font-size:14px}

    .search{
      flex:1; display:flex; gap:10px; align-items:center;
      background: rgba(17,24,41,.85);
      border:1px solid rgba(34,48,77,.7);
      border-radius: 999px;
      padding:9px 12px;
      box-shadow: var(--shadow);
      min-width: 260px;
    }
    .search input{
      flex:1; background: transparent; border:0; outline:none;
      color:var(--text); font-size:13px;
    }
    .search input::placeholder{color:rgba(167,180,214,.75)}
    .kbd{
      border:1px solid rgba(34,48,77,.75);
      background: rgba(7,10,18,.45);
      padding: 2px 6px;
      border-radius: 8px;
      font-weight:900;
      color: rgba(233,238,252,.9);
    }
    .quick{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    }
    .btn{
      border:1px solid rgba(34,48,77,.9);
      background: linear-gradient(180deg, rgba(17,24,41,.92), rgba(15,21,36,.92));
      color:var(--text);
      padding:9px 10px;
      border-radius: 14px;
      cursor:pointer;
      box-shadow: var(--shadow);
      font-weight:800;
      font-size:12px;
      user-select:none;
      transition: transform .08s ease, filter .2s ease;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.05)}
    .btn:active{transform: translateY(0px)}
    .btn.danger{
      border-color: rgba(255,92,122,.75);
      background: linear-gradient(180deg, rgba(255,92,122,.18), rgba(17,24,41,.95));
    }

    .pillrow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;}
    .pill{
      border:1px solid rgba(34,48,77,.7);
      background: rgba(17,24,41,.55);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      color:rgba(167,180,214,.95);
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .2s ease, border .2s ease;
    }
    .pill:hover{transform: translateY(-1px); background: rgba(17,24,41,.9); color: var(--text)}
    .pill.active{border-color: rgba(124,92,255,.75); color: var(--text); background: rgba(124,92,255,.12)}

    main{padding:16px 16px 56px}
    .grid{
      max-width:1180px; margin:0 auto;
      display:grid; grid-template-columns: 1fr; gap:14px;
    }
    @media (min-width: 980px){ .grid{grid-template-columns: 1fr 1fr;} }

    .card{
      background: linear-gradient(180deg, rgba(17,24,41,.9), rgba(15,21,36,.85));
      border:1px solid rgba(34,48,77,.7);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardheader{
      padding:12px 14px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      border-bottom:1px solid rgba(34,48,77,.55);
      background: rgba(15,21,36,.55);
    }
    .title{display:flex; flex-direction:column; gap:3px;}
    .title h2{margin:0; font-size:14px; letter-spacing:.2px;}
    .title .meta{margin:0; font-size:12px; color:rgba(167,180,214,.9);}

    .progress{
      min-width:150px; text-align:right;
      display:flex; flex-direction:column; gap:6px;
    }
    .bar{
      height:10px; border-radius:999px;
      background: rgba(34,48,77,.45);
      border:1px solid rgba(34,48,77,.55);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      background: linear-gradient(90deg, rgba(124,92,255,.9), rgba(37,208,127,.85));
      width:0%;
      transition: width .25s ease;
    }
    .progress .pct{font-size:12px; color:rgba(167,180,214,.95)}
    .list{padding:10px 10px 12px}

    .groupTitle{
      padding:8px 10px 6px;
      color:rgba(167,180,214,.95);
      font-weight:900;
      font-size:12px;
      letter-spacing:.4px;
      text-transform:uppercase;
    }

    .item{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid transparent;
      transition: background .2s ease, border .2s ease;
      user-select:none;
    }
    .item:hover{
      background: rgba(124,92,255,.06);
      border-color: rgba(34,48,77,.55);
    }

    .left{display:flex; gap:12px; align-items:center; min-width:0;}
    .check{
      width:18px; height:18px; border-radius:6px;
      border:1px solid rgba(34,48,77,.9);
      background: rgba(7,10,18,.6);
      display:grid; place-items:center;
      flex:0 0 auto;
    }
    .check svg{opacity:0; transform: scale(.9); transition: all .18s ease}
    .item.done .check{
      border-color: rgba(37,208,127,.9);
      background: rgba(37,208,127,.12);
    }
    .item.done .check svg{opacity:1; transform: scale(1)}
    .name{display:flex; flex-direction:column; gap:3px; min-width:0;}
    .name .main{font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .name .sub{
      font-size:12px; color:rgba(167,180,214,.9);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .right{display:flex; align-items:center; gap:8px; flex:0 0 auto;}
    .count{
      font-variant-numeric: tabular-nums;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(34,48,77,.8);
      background: rgba(7,10,18,.45);
      color:rgba(233,238,252,.95);
      min-width:120px;
      text-align:center;
    }
    .count strong{color:var(--ok)}
    .mini{
      padding:7px 10px;
      border-radius:12px;
      border:1px solid rgba(34,48,77,.8);
      background: rgba(7,10,18,.35);
      cursor:pointer;
      color:rgba(233,238,252,.95);
      font-weight:900;
      user-select:none;
      transition: filter .15s ease, transform .08s ease;
      white-space:nowrap;
    }
    .mini:hover{filter:brightness(1.08); transform: translateY(-1px)}
    .mini:active{transform: translateY(0px)}
    .mini.all{
      border-color: rgba(124,92,255,.75);
      background: rgba(124,92,255,.12);
    }
    .item.done .count{
      border-color: rgba(37,208,127,.55);
      background: rgba(37,208,127,.08);
    }

    .notice{
      max-width:1180px;
      margin:0 auto;
      padding:14px 16px;
      border-radius: 16px;
      border:1px solid rgba(34,48,77,.7);
      background: rgba(17,24,41,.55);
      color: rgba(167,180,214,.95);
      box-shadow: var(--shadow);
      display:none;
    }
    .notice.show{display:block;}

    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background: rgba(17,24,41,.92);
      border: 1px solid rgba(34,48,77,.8);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: var(--shadow);
      opacity:0; pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      color: rgba(233,238,252,.95);
      font-weight:800;
      z-index:100;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}

    footer{
      max-width:1180px;
      margin:0 auto;
      padding: 10px 16px 38px;
      font-size:12px;
      color: rgba(167,180,214,.85);
    }
    footer b{color:rgba(233,238,252,.9)}
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">Antquestions Loot</div>
      </div>

      <div class="search" role="search">
        <span style="opacity:.85">üîé</span>
        <input id="searchInput" placeholder="–ü–æ–∏—Å–∫‚Ä¶ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)" autocomplete="off" />
        <span class="kbd" title="–§–æ–∫—É—Å">/</span>
      </div>

      <div class="quick">
        <button class="btn" id="btnExport" title="Ctrl+S">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <label class="btn" title="Ctrl+O" style="cursor:pointer;">
          –ò–º–ø–æ—Ä—Ç
          <input id="fileImport" type="file" accept="application/json" style="display:none;">
        </label>
        <button class="btn danger" id="btnImportReplace" title="–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏–∑ —Ñ–∞–π–ª–∞">
          –ò–º–ø–æ—Ä—Ç (–∑–∞–º–µ–Ω–∞)
        </button>
      </div>
    </div>

    <div class="pillrow" id="categoryPills"></div>
  </div>
</header>

<main>
  <div class="notice" id="noResults">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üò∂</div>
  <div class="grid" id="grid"></div>
</main>

<footer>
  –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: <b>/</b> —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–∏—Å–∫, <b>Ctrl+S</b> —ç–∫—Å–ø–æ—Ä—Ç, <b>Ctrl+O</b> –∏–º–ø–æ—Ä—Ç.
  <br/>–ü—Ä–æ–≥—Ä–µ—Å—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (<b>localStorage</b>).
</footer>

<div class="toast" id="toast"></div>

<script>
  // =======================
  // DATA
  // =======================
  const DATA = [
    {
      id: "quests",
      title: "–î–ª—è –∫–≤–µ—Å—Ç–æ–≤",
      subtitle: "–ö–≤–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã",
      groups: [{ groupTitle: "–°–ø–∏—Å–æ–∫", items: [
        { name: "–ò–º–ø—É–ª—å—Å–Ω—ã–π –±–ª–æ–∫ ¬´–ü—Ä—ã–≥—É–Ω–∞¬ª", need: 1 },
        { name: "–≠–ª–µ–º–µ–Ω—Ç –ø–∏—Ç–∞–Ω–∏—è", need: 1 },
        { name: "–î—Ä–∞–π–≤–µ—Ä ¬´–†–∞–∫–µ—Ç—á–∏–∫–∞¬ª", need: 1 },
        { name: "–ú–∞–≥–Ω–µ—Ç—Ä–æ–Ω", need: 1 },
        { name: "–†–µ–≥—É–ª—è—Ç–æ—Ä –ø–æ—Ç–æ–∫–∞", need: 1 },
        { name: "–í–æ–¥—è–Ω–æ–π –Ω–∞—Å–æ—Å", need: 1 },
        { name: "–°–µ–π—Ñ ¬´–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—è¬ª", need: 1 },
        { name: "–ê–Ω—Ç–∏—Å–µ–ø—Ç–∏–∫", need: 2 },
        { name: "–î—Ä–∞–π–≤–µ—Ä ¬´–®–µ—Ä—à–Ω—è¬ª", need: 2 },
        { name: "–®–ø—Ä–∏—Ü", need: 1 },
        { name: "–î—Ä–∞–π–≤–µ—Ä ¬´–û—Å—ã¬ª", need: 2 },
        { name: "–°–∫–∞–Ω–µ—Ä ¬´–°—Ç—É–∫–∞—á–∞¬ª", need: 2 },
        { name: "–ü—Ä–æ–≤–æ–¥–∞", need: 18 },
        { name: "–ë–∞—Ç–∞—Ä–µ—è", need: 3 },
        { name: "–°–ø–ª–∞–≤ ARC", need: 3 },
        { name: "–ë—É—Ä–ª–µ—Ç—Ç–∞", need: 1 },
        { name: "–ü—Ä–æ—á–Ω–∞—è —Ç–∫–∞–Ω—å", need: 1 },
        { name: "–ö–æ—Ä–æ–≤—è–∫", need: 1 },
        { name: "–£–¥–æ–±—Ä–µ–Ω–∏–µ", need: 1 },
      ]}]
    },

    {
      id: "plushkin",
      title: "–î–ª—è –ü–ª—é—à–∫–∏–Ω–∞",
      subtitle: "–ü–æ —É—Ä–æ–≤–Ω—è–º",
      groups: [
        { groupTitle: "–£–†. 2", items: [{ name: "–°–æ–±–∞—á–∏–π –æ—à–µ–π–Ω–∏–∫", need: 1 }] },
        { groupTitle: "–£–†. 3", items: [{ name: "–õ–∏–º–æ–Ω", need: 3 }, { name: "–ê–±—Ä–∏–∫–æ—Å", need: 3 }]},
        { groupTitle: "–£–†. 4", items: [{ name: "–û–ø—É–Ω—Ü–∏—è", need: 6 }, { name: "–û–ª–∏–≤–∫–∏", need: 6 }, { name: "–ö–æ—à–∞—á—å—è –ª–µ–∂–∞–Ω–∫–∞", need: 1 }]},
        { groupTitle: "–£–†. 5", items: [{ name: "–ì—Ä–∏–±", need: 12 }, { name: "–ê–±—Ä–∏–∫–æ—Å", need: 12 }, { name: "–û—á–µ–Ω—å —É–¥–æ–±–Ω–∞—è –ø–æ–¥—É—à–∫–∞", need: 3 }]},
      ]
    },


    { id:"wb_weapon_2", title:"–û—Ä—É–∂. –≤–µ—Ä—Å—Ç–∞–∫ ‚Äî –£–†.2", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.2", items:[
      { name:"–†–∂–∞–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã", need:3 },
      { name:"–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need:5 },
      { name:"–î—Ä–∞–π–≤–µ—Ä ¬´–û—Å—ã¬ª", need:8 },
    ]}]},
    { id:"wb_weapon_3", title:"–û—Ä—É–∂. –≤–µ—Ä—Å—Ç–∞–∫ ‚Äî –£–†.3", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.3", items:[
      { name:"–†–∂–∞–≤–∞—è —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞", need:3 },
      { name:"–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need:5 },
      { name:"–û–≥–Ω–µ–≤–æ–µ —è–¥—Ä–æ ¬´–ß–∞—Å–æ–≤–æ–≥–æ¬ª", need:4 },
    ]}]},

    { id:"wb_gear_2", title:"–í–µ—Ä—Å—Ç–∞–∫ –¥–ª—è —Å–Ω–∞—Ä—è–∂. ‚Äî –£–†.2", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.2", items:[
      { name:"–°–∏–ª–æ–≤–æ–π –∫–∞–±–µ–ª—å", need:3 },
      { name:"–î—Ä–∞–π–≤–µ—Ä ¬´–®–µ—Ä—à–Ω—è¬ª", need:5 },
      { name:"–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need:5 },
    ]}]},
    { id:"wb_gear_3", title:"–í–µ—Ä—Å—Ç–∞–∫ –¥–ª—è —Å–Ω–∞—Ä—è–∂. ‚Äî –£–†.3", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.3", items:[
      { name:"–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –±–∞—Ç–∞—Ä–µ—è", need:3 },
      { name:"–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need:5 },
      { name:"–Ø—á–µ–π–∫–∞ ¬´–ë–∞—Å—Ç–∏–æ–Ω–∞¬ª", need:6 },
    ]}]},

    { id:"wb_med_2", title:"–ú–µ–¥. –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è ‚Äî –£–†.2", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.2", items:[
      { name:"–¢—Ä–µ—Å–Ω—É–≤—à–∏–π –±–∏–æ—Å–∫–∞–Ω–µ—Ä", need:2 },
      { name:"–ü—Ä–æ—á–Ω–∞—è —Ç–∫–∞–Ω—å", need:5 },
      { name:"–û–±–æ–ª–æ—á–∫–∞ ¬´–ë–ª–æ—Ö–∏¬ª", need:8 },
    ]}]},
    { id:"wb_med_3", title:"–ú–µ–¥. –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è ‚Äî –£–†.3", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.3", items:[
      { name:"–ê–ø—Ç–µ—á–∫–∞ —Å —Ä–∂–∞–≤—ã–º –∑–∞–º–∫–æ–º", need:3 },
      { name:"–ê–Ω—Ç–∏—Å–µ–ø—Ç–∏–∫", need:8 },
      { name:"–°–µ–π—Ñ ¬´–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—è¬ª", need:5 },
    ]}]},

    { id:"wb_purifier_2", title:"–û—á–∏—Å—Ç–∏—Ç–µ–ª—å ‚Äî –£–†.2", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.2", items:[
      { name:"–¢–æ—Å—Ç–µ—Ä", need:3 },
      { name:"–î–≤–∏–∂—É—â–µ–µ —è–¥—Ä–æ ARC", need:5 },
      { name:"–ì–æ—Ä–µ–ª–∫–∞ ¬´–û–≥–Ω–µ—à–∞—Ä–∞¬ª", need:8 },
    ]}]},
    { id:"wb_purifier_3", title:"–û—á–∏—Å—Ç–∏—Ç–µ–ª—å ‚Äî –£–†.3", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.3", items:[
      { name:"–ú–æ—Ç–æ—Ä", need:3 },
      { name:"–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ ARC", need:10 },
      { name:"–Ø—á–µ–π–∫–∞ ¬´–ë–æ–º–±–∞—Ä–¥–∏—Ä–∞¬ª", need:6 },
    ]}]},

    { id:"wb_tools_2", title:"–í–µ—Ä—Å—Ç–∞–∫ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ‚Äî –£–†.2", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.2", items:[
      { name:"–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–π —Ç–µ–ø–ª–æ–ø–æ–≥–ª–æ—Ç–∏—Ç–µ–ª—å", need:2 },
      { name:"–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need:5 },
      { name:"–°–∫–∞–Ω–µ—Ä ¬´–°—Ç—É–∫–∞—á–∞¬ª", need:6 },
    ]}]},
    { id:"wb_tools_3", title:"–í–µ—Ä—Å—Ç–∞–∫ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ‚Äî –£–†.3", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.3", items:[
      { name:"–°–≥–æ—Ä–µ–≤—à–∞—è –º–∞—Ç–µ—Ä–∏–Ω—Å–∫–∞—è –ø–ª–∞—Ç–∞", need:3 },
      { name:"–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need:5 },
      { name:"–ò–º–ø—É–ª—å—Å–Ω—ã–π –±–ª–æ–∫ ¬´–ü—Ä—ã–≥—É–Ω–∞¬ª", need:4 },
    ]}]},

    { id:"wb_explosives_2", title:"–í–µ—Ä—Å—Ç–∞–∫ –¥–ª—è –≤–∑—Ä—ã–≤—á–∞—Ç–∫–∏ ‚Äî –£–†.2", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.2", items:[
      { name:"–°–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ", need:3 },
      { name:"–°–∞–º–æ–¥–µ–ª—å–Ω–∞—è –≤–∑—Ä—ã–≤—á–∞—Ç–∫–∞", need:5 },
      { name:"–ü—É—Å–∫–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ¬´–í–∑—Ä—ã–≤–æ–±–æ—Ç–∞¬ª", need:5 },
    ]}]},
    { id:"wb_explosives_3", title:"–í–µ—Ä—Å—Ç–∞–∫ –¥–ª—è –≤–∑—Ä—ã–≤—á–∞—Ç–∫–∏ ‚Äî –£–†.3", subtitle:"–ü—Ä–æ–∫–∞—á–∫–∞", groups:[{groupTitle:"–£–†.3", items:[
      { name:"–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–µ–∞–≥–µ–Ω—Ç—ã", need:3 },
      { name:"–í–∑—Ä—ã–≤—á–∞—Ç–æ–µ –≤–µ—â–µ—Å—Ç–≤–æ", need:5 },
      { name:"–î—Ä–∞–π–≤–µ—Ä ¬´–†–∞–∫–µ—Ç—á–∏–∫–∞¬ª", need:3 },
    ]}]},

    {
      id: "exp1",
      title: "–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è ‚Ññ1",
      subtitle: "–≠—Ç–∞–ø—ã 1‚Äì4",
      groups: [{ groupTitle: "–°–ø–∏—Å–æ–∫", items: [
        { name: "–ò–º–ø—É–ª—å—Å–Ω—ã–π –±–ª–æ–∫ ¬´–ü—Ä—ã–≥—É–Ω–∞¬ª", need: 3 },
        { name: "–ú–∞–≥–Ω–∏—Ç–Ω—ã–π —É—Å–∫–æ—Ä–∏—Ç–µ–ª—å", need: 3 },
        { name: "–ú–æ–¥—É–ª–∏ –∏—Å—Ö–æ–¥–∞", need: 1 },
        { name: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need: 5 },
        { name: "–£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å", need: 5 },
        { name: "–î–∞—Ç—á–∏–∫–∏", need: 20 },
        { name: "–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è", need: 5 },
        { name: "–ë–∞—Ç–∞—Ä–µ—è", need: 30 },
        { name: "–õ–∞–º–ø–æ—á–∫–∞", need: 5 },
        { name: "–ü—Ä–æ–≤–æ–¥–∞", need: 30 },
        { name: "–ü—Ä–æ—á–Ω–∞—è —Ç–∫–∞–Ω—å", need: 35 },
        { name: "–°—Ç–∞–ª—å–Ω–∞—è –ø—Ä—É–∂–∏–Ω–∞", need: 15 },
        { name: "–°–ø–ª–∞–≤ ARC", need: 80 },
        { name: "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need: 30 },
        { name: "–†–µ–∑–∏–Ω–æ–≤—ã–µ –¥–µ—Ç–∞–ª–∏", need: 200 },
        { name: "–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏", need: 150 },
      ]}]
    },
    {
      id: "exp2",
      title: "–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è ‚Ññ2",
      subtitle: "–≠—Ç–∞–ø—ã 1‚Äì4",
      groups: [{ groupTitle: "–°–ø–∏—Å–æ–∫", items: [
        { name: "–ò–º–ø—É–ª—å—Å–Ω—ã–π –±–ª–æ–∫ ¬´–ü—Ä—ã–≥—É–Ω–∞¬ª", need: 3 },
        { name: "–ò–æ–Ω–Ω—ã–π —Ä–∞—Å–ø—ã–ª–∏—Ç–µ–ª—å", need: 3 },
        { name: "–ú–æ–¥—É–ª–∏ –∏—Å—Ö–æ–¥–∞", need: 1 },
        { name: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need: 5 },
        { name: "–ú–æ–¥—É–ª—è—Ç–æ—Ä —á–∞—Å—Ç–æ—Ç", need: 5 },
        { name: "–ì–∏—Ä–æ—Å–∫–æ–ø –∏–∑–º–µ–ª—å—á–∏—Ç–µ–ª—è", need: 10 },
        { name: "–ó–º–µ–µ–≤–∏–∫ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è", need: 4 },
        { name: "–ë–∞—Ç–∞—Ä–µ—è", need: 30 },
        { name: "–õ–∞–º–ø–æ—á–∫–∞", need: 4 },
        { name: "–ü—Ä–æ–≤–æ–¥–∞", need: 25 },
        { name: "–ü—Ä–æ—á–Ω–∞—è —Ç–∫–∞–Ω—å", need: 35 },
        { name: "–°—Ç–∞–ª—å–Ω–∞—è –ø—Ä—É–∂–∏–Ω–∞", need: 15 },
        { name: "–°–ø–ª–∞–≤ ARC", need: 80 },
        { name: "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã", need: 20 },
        { name: "–ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ –¥–µ—Ç–∞–ª–∏", need: 200 },
        { name: "–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏", need: 150 },
      ]}]
    },
  ];

  // =======================
  // STATE
  // =======================
  const LS_KEY = "antquestions_loot_progress_v1";

  function loadState(){
    try{ return JSON.parse(localStorage.getItem(LS_KEY) || "{}"); }
    catch(e){ return {}; }
  }
  function saveState(st){ localStorage.setItem(LS_KEY, JSON.stringify(st)); }
  let state = loadState();

  // =======================
  // HELPERS / UI
  // =======================
  const grid = document.getElementById("grid");
  const pills = document.getElementById("categoryPills");
  const searchInput = document.getElementById("searchInput");
  const noResults = document.getElementById("noResults");

  let activeFilter = "all";

  function slugify(s){
    return s.toLowerCase()
      .replaceAll("—ë","–µ")
      .replace(/[^a-z–∞-—è0-9]+/gi, "-")
      .replace(/^-+|-+$/g,"");
  }
  function itemKey(sectionId, groupTitle, name){
    return `${sectionId}__${slugify(groupTitle)}__${slugify(name)}`;
  }
  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function toast(msg){
    const el = document.getElementById("toast");
    el.textContent = msg;
    el.classList.add("show");
    clearTimeout(toast._t);
    toast._t = setTimeout(()=>el.classList.remove("show"), 1200);
  }

  function computeSectionProgress(section){
    let needTotal = 0, gotTotal = 0;
    section.groups.forEach(g=>{
      g.items.forEach(it=>{
        const key = itemKey(section.id, g.groupTitle, it.name);
        const got = clamp(Number(state[key]||0), 0, it.need);
        needTotal += it.need;
        gotTotal += got;
      });
    });
    const pct = needTotal ? Math.round((gotTotal/needTotal)*100) : 0;
    return {needTotal, gotTotal, pct};
  }

  function setCount(key, need, value){
    state[key] = clamp(value, 0, need);
    saveState(state);
  }
  function addCount(key, need, delta){
    const cur = clamp(Number(state[key]||0), 0, need);
    setCount(key, need, cur + delta);
  }

  function buildCategoryPills(){
    const all = [{id:"all", title:"–í—Å–µ"}].concat(DATA.map(d=>({id:d.id, title:d.title})));
    pills.innerHTML = "";
    all.forEach(c=>{
      const b = document.createElement("div");
      b.className = "pill" + (c.id===activeFilter ? " active" : "");
      b.textContent = c.title;
      b.onclick = ()=>{
        activeFilter = c.id;
        [...pills.children].forEach(x=>x.classList.remove("active"));
        b.classList.add("active");
        render();
      };
      pills.appendChild(b);
    });
  }

  // =======================
  // RENDER
  // =======================
  function render(){
    grid.innerHTML = "";
    const sections = (activeFilter==="all") ? DATA : DATA.filter(x=>x.id===activeFilter);

    sections.forEach(section=>{
      const card = document.createElement("section");
      card.className = "card";

      const prog = computeSectionProgress(section);

      const header = document.createElement("div");
      header.className = "cardheader";
      header.innerHTML = `
        <div class="title">
          <h2>${section.title}</h2>
          <p class="meta">${section.subtitle || ""}</p>
        </div>
        <div class="progress">
          <div class="pct"><b>${prog.gotTotal}</b> / ${prog.needTotal} ‚Ä¢ ${prog.pct}%</div>
          <div class="bar"><div style="width:${prog.pct}%"></div></div>
        </div>
      `;

      const list = document.createElement("div");
      list.className = "list";

      section.groups.forEach(group=>{
        const gt = document.createElement("div");
        gt.className = "groupTitle";
        gt.textContent = group.groupTitle;
        list.appendChild(gt);

        group.items.forEach(it=>{
          const key = itemKey(section.id, group.groupTitle, it.name);
          const got = clamp(Number(state[key]||0), 0, it.need);
          const done = got >= it.need;

          const row = document.createElement("div");
          row.className = "item" + (done ? " done" : "");
          row.dataset.name = it.name.toLowerCase();
          row.dataset.section = section.id;

          const left = document.createElement("div");
          left.className = "left";
          left.innerHTML = `
            <div class="check" title="–ì–æ—Ç–æ–≤–æ">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                <path d="M16.6 6.2L8.7 14.1 3.4 8.8" stroke="rgba(37,208,127,.95)" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="name">
              <div class="main">${it.name}</div>
              <div class="sub">${section.title} ‚Ä¢ ${group.groupTitle}</div>
            </div>
          `;

          const right = document.createElement("div");
          right.className = "right";

          const count = document.createElement("div");
          count.className = "count";
          count.innerHTML = `–°–æ–±—Ä–∞–Ω–æ: <strong>${got}</strong> / ${it.need}`;

          const btnMinus = document.createElement("div");
          btnMinus.className = "mini";
          btnMinus.textContent = "‚àí1";
          btnMinus.title = "–£–±–∞–≤–∏—Ç—å ‚àí1";
          btnMinus.onclick = (e)=>{
            e.stopPropagation();
            addCount(key, it.need, -1);
            render();
            applySearch(searchInput.value.trim());
          };

          const btnPlus = document.createElement("div");
          btnPlus.className = "mini";
          btnPlus.textContent = "+1";
          btnPlus.title = "–î–æ–±–∞–≤–∏—Ç—å +1";
          btnPlus.onclick = (e)=>{
            e.stopPropagation();
            addCount(key, it.need, +1);
            render();
            applySearch(searchInput.value.trim());
          };

          const btnAll = document.createElement("div");
          btnAll.className = "mini all";
          btnAll.textContent = "–í–°–Å";
          btnAll.title = "–°–æ–±—Ä–∞—Ç—å –≤—Å—ë –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É";
          btnAll.onclick = (e)=>{
            e.stopPropagation();
            setCount(key, it.need, it.need);
            render();
            applySearch(searchInput.value.trim());
            toast(`–ì–æ—Ç–æ–≤–æ: ${it.name}`);
          };

          right.appendChild(count);
          right.appendChild(btnMinus);
          right.appendChild(btnPlus);
          right.appendChild(btnAll);

          row.appendChild(left);
          row.appendChild(right);

          list.appendChild(row);
        });
      });

      card.appendChild(header);
      card.appendChild(list);
      grid.appendChild(card);
    });

    applySearch(searchInput.value.trim());
  }

  // =======================
  // SEARCH
  // =======================
  function applySearch(query){
    const q = query.toLowerCase().trim();
    const cards = [...document.querySelectorAll(".card")];

    let anyMatch = false;

    cards.forEach(card=>{
      const list = card.querySelector(".list");
      const groupTitles = [...list.querySelectorAll(".groupTitle")];
      const items = [...list.querySelectorAll(".item")];

  
      groupTitles.forEach(gt => gt.style.display = "block");
      items.forEach(it => it.style.display = "grid");

      if(!q){
    
        card.style.display = "block";
        return;
      }

      items.forEach(it=>{
        const name = it.dataset.name || "";
        const match = name.includes(q);
        it.style.display = match ? "grid" : "none";
        if(match) anyMatch = true;
      });


      groupTitles.forEach(gt=>{
  
        let next = gt.nextElementSibling;
        let hasVisible = false;
        while(next && !next.classList.contains("groupTitle")){
          if(next.classList.contains("item") && next.style.display !== "none"){
            hasVisible = true;
            break;
          }
          next = next.nextElementSibling;
        }
        gt.style.display = hasVisible ? "block" : "none";
      });

 
      const hasAnyVisibleItem = items.some(it => it.style.display !== "none");
      card.style.display = hasAnyVisibleItem ? "block" : "none";
    });

    // –°–æ–æ–±—â–µ–Ω–∏–µ "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
    if(q && !anyMatch){
      noResults.classList.add("show");
    } else {
      noResults.classList.remove("show");
    }
  }

  searchInput.addEventListener("input", (e)=> applySearch(e.target.value));
  searchInput.addEventListener("keydown", (e)=>{
    if(e.key === "Escape"){
      searchInput.value = "";
      applySearch("");
    }
  });


  window.addEventListener("keydown", (e)=>{
    if(e.key === "/" && document.activeElement !== searchInput){
      e.preventDefault();
      searchInput.focus();
    }

    if(e.ctrlKey && e.key.toLowerCase()==="s"){
      e.preventDefault();
      document.getElementById("btnExport")?.click();
    }

    if(e.ctrlKey && e.key.toLowerCase()==="o"){
      e.preventDefault();
      document.getElementById("fileImport")?.click();
    }
  });

  // =======================
  // IMPORT / EXPORT JSON
  // =======================
  function downloadTextFile(filename, text) {
    const blob = new Blob([text], { type: "application/json;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function validateImportedProgress(obj) {
    if (!obj || typeof obj !== "object" || Array.isArray(obj)) return false;
    for (const [k, v] of Object.entries(obj)) {
      if (typeof k !== "string") return false;
      if (typeof v !== "number" || !Number.isFinite(v) || v < 0) return false;
    }
    return true;
  }


  document.getElementById("btnExport")?.addEventListener("click", () => {
    const payload = {
      meta: {
        app: "antquestions-loot",
        version: 1,
        exportedAt: new Date().toISOString(),
        lsKey: LS_KEY
      },
      progress: state
    };
    downloadTextFile("antquestions-loot.json", JSON.stringify(payload, null, 2));
    toast("–≠–∫—Å–ø–æ—Ä—Ç ‚úÖ");
  });


  document.getElementById("fileImport")?.addEventListener("change", async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;

    try {
      const text = await file.text();
      const parsed = JSON.parse(text);
      const incoming = parsed?.progress ?? parsed;

      if (!validateImportedProgress(incoming)) {
        toast("–ù–µ —Ç–æ—Ç JSON ‚ùå");
        e.target.value = "";
        return;
      }

      let changed = 0;
      for (const [k, v] of Object.entries(incoming)) {
        const cur = Number(state[k] || 0);
        const next = Math.max(cur, Number(v));
        if (next !== cur) {
          state[k] = next;
          changed++;
        }
      }

      saveState(state);
      render();
      toast(`–ò–º–ø–æ—Ä—Ç: +${changed} ‚úÖ`);
    } catch (err) {
      toast("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ ‚ùå");
    } finally {
      e.target.value = "";
    }
  });


  document.getElementById("btnImportReplace")?.addEventListener("click", async () => {
    const input = document.getElementById("fileImport");
    if (!input) return;

    input.click();

    const handler = async (e) => {
      const file = e.target.files?.[0];
      if (!file) {
        input.removeEventListener("change", handler);
        return;
      }

      const ok = confirm("–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏–∑ —Ñ–∞–π–ª–∞?");
      if (!ok) {
        input.value = "";
        input.removeEventListener("change", handler);
        return;
      }

      try {
        const text = await file.text();
        const parsed = JSON.parse(text);
        const incoming = parsed?.progress ?? parsed;

        if (!validateImportedProgress(incoming)) {
          toast("–ù–µ —Ç–æ—Ç JSON ‚ùå");
          return;
        }

        state = incoming;
        saveState(state);
        render();
        toast("–ò–º–ø–æ—Ä—Ç (–∑–∞–º–µ–Ω–∞) ‚úÖ");
      } catch (err) {
        toast("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ ‚ùå");
      } finally {
        input.value = "";
        input.removeEventListener("change", handler);
      }
    };

    input.addEventListener("change", handler);
  });


  buildCategoryPills();
  render();
  applySearch("");
</script>

</body>
</html>
